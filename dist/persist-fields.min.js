(function(){function t(e){if(e=="queryStorage"||e=="fragmentStorage"||e=="cookieStorage"||e=="httpStorage"){return true}let t;try{t=window[e];const i="__storage_test__";t.setItem(i,i);t.removeItem(i);return true}catch(e){return e instanceof DOMException&&(e.code===22||e.code===1014||e.name==="QuotaExceededError"||e.name==="NS_ERROR_DOM_QUOTA_REACHED")&&t&&t.length!==0}}function l(e){return(e===undefined?"":Array.isArray(e)?e.join(""):e.toString()).replaceAll("%2C",",").replaceAll("%3A",":").replaceAll("%2F","/")}function s(e,t,i){return i.indexOf(e)===t}function a(e){return e.type==="checkbox"||e.type==="radio"}function o(e,t){let i=t==e.getAttribute("name")||t==e.getAttribute("persist-fields-name")?[e]:[];return i.concat([...e.querySelectorAll('[name="'+t+'"'),...e.querySelectorAll('[persist-fields-name="'+t+'"]')])}function d(e){return a(e)?[e.checked]:e.tagName==="SELECT"?[...e.selectedOptions].map(e=>e.value):e.tagName==="INPUT"||e.tagName==="TEXTAREA"?[e.value]:[e.innerText]}function e(e){return a(e)?[e.defaultChecked]:e.tagName==="SELECT"?[...e.options].filter(e=>e.defaultSelected).map(e=>e.value):e.tagName==="INPUT"||e.tagName==="TEXTAREA"?[e.defaultValue]:[e.innerText]}function c(e,t,i){let n=o(e,t).filter(e=>!e.closest(":disabled"));let r=n.filter(a).filter(e=>i(e)[0]).map(e=>e.value).join(",");let l=n.filter(e=>!a(e));while(l.length>0&&(JSON.stringify(i(l[l.length-1]))==='[""]'||l[l.length-1].hasAttribute("readonly")&&!l[l.length-1].hasAttribute("required"))){l.splice(-1,1)}return[r].filter(e=>e!="").concat(l.flatMap(i))}function u(e){if(["INPUT","TEXTAREA","SELECT"].includes(e.tagName)&&e.hasAttribute("name")||e.hasAttribute("persist-fields-name")){return[e]}else{var i=[];e.querySelectorAll("input[name], textarea[name], select[name], [persist-fields-name]").forEach(t=>{q.withExtensions(t,function(e){if(e._ext_persist_fields){i.push(t)}})});return i}}function n(i,e,n){if(typeof i==="number"){var t=n.trim().length==0?[]:n.split(e);return i<t.length?[t[i]]:undefined}else if(typeof i==="string"){let e=new URLSearchParams(n);let t=e.has(i)?e.getAll(i):undefined;return Array.isArray(t)&&t.length==1&&t[0]===""?[]:t}else{throw new Error("Invalid storageKey")}}function g(e,t,i){if(e=="query"){i(n(t,"&",window.location.search.substring(1)))}else if(e=="fragment"){i(n(t,"#",window.location.hash.substring(1)))}else if(e=="cookie"){let e=document.cookie.split("; ").filter(e=>e.length>0).map(e=>{let t=e.split("=");let i={};i[t[0]]=t[1]===undefined?undefined:t[1].split(",").map(decodeURIComponent);return i}).reduce((e,t)=>Object.assign(e,t),{});i(t?e[t]?e[t]:undefined:document.cookie.length==0?undefined:e)}else if(e=="session"){i(JSON.parse(sessionStorage.getItem(t))||{})}else if(e=="local"){i(JSON.parse(localStorage.getItem(t))||{})}else if(e=="http"){let e=new XMLHttpRequest;e.open("GET",t);e.onload=()=>{i(JSON.parse(e.responseText))};e.send()}}function r(i,e,n,r){if(typeof i==="number"){const t=n.substring(1).split(e);while(t.length<=i){t.push("")}t[i]=l(r);return t.join(e).replace(new RegExp(e+"+$"),"")}else{let t=new URLSearchParams(n.substring(1));t.delete(i);if(r===undefined){}else if(r.length==0){t.append(i,"")}else{r.forEach(e=>t.append(i,l(e)))}return l(t)}}function h(e,t,i,n){if(e==="query"){let e=r(i,"&",window.location.search,t);if(e!==window.location.search.substring(1)){history.replaceState(null,null,window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+e+window.location.hash)}}else if(e==="fragment"){let e=r(i,"#",window.location.hash,t);if(e!==window.location.hash.substring(1)){history.replaceState(null,null,window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search+"#"+e)}}else if(e==="cookie"){if(t){document.cookie=i+"="+t.map(encodeURIComponent).join(",")+";"+n}else{document.cookie=i+"=;max-age=0"}}else if(e==="session"){if(t===undefined){sessionStorage.removeItem(i)}else{sessionStorage.setItem(i,JSON.stringify(t))}}else if(e==="local"){if(t===undefined){localStorage.removeItem(i)}else{localStorage.setItem(i,JSON.stringify(t))}}else if(e==="http"){let e=new XMLHttpRequest;if(t===undefined){e.open("DELETE",i);e.send()}else{e.open("PUT",i);e.send(JSON.stringify(t))}}}function p(e,t){if(t){if(t.delete){t.delete(e)}else if(t[e]!==undefined){delete t[e]}}return t}function f(e,t,i){g(e,i,()=>{if(t){t.querySelectorAll("[data-persist-fields-initialized]").forEach(e=>{if(a(e)){e.checked=e.getAttribute("data-persist-fields-initialized")==="true"}else{e.value=e.getAttribute("data-persist-fields-initialized")}})}h(e,undefined,i)})}function i(e,n,t,r){if(r!==undefined){if(a(n)){n.checked=r.flatMap(e=>e.split(",")).includes(n.value)}else{let i=o(e,t);if(i.length===1){if(n.tagName==="INPUT"||n.tagName==="TEXTAREA"){n.value=r.length==0?"":r.join(",")}else if(n.tagName==="SELECT"){[...n.options].forEach(e=>e.selected=r.flatMap(e=>e.split(",")).includes(e.value))}else{n.innerText=r.length==0?"":r.join("")}}else{let e=i.indexOf(n);let t=N(i,r,e);if(t!==undefined){if(n.tagName==="INPUT"||n.tagName==="TEXTAREA"){n.value=t}else if(n.tagName==="SELECT"){[...n.options].forEach(e=>e.selected=t===e.value)}else{n.innerText=t}}}}}}function m(t,i){if(i.hasAttribute("readonly")){if(t.startsWith(i.getAttribute("value"))){let e=i.getAttribute("value");return[e,t.substring(e.length)]}}return undefined}function A(t,i){if(i.hasAttribute("minlength")&&i.getAttribute("minlength")===i.getAttribute("maxlength")){let e=t.substring(0,parseInt(i.getAttribute("minlength")));return[e,t.substring(e.length)]}return undefined}function b(i,n){if(n.hasAttribute("pattern")){let e=n.getAttribute("pattern");let t=i.match(e.startsWith("^")?e:"^"+e);if(t!==null){let e=t.length>1?t[1]:t[0];return[e,i.substring(e.length)]}}return undefined}function E(i,e){if(e.getAttribute("type")==="datetime-local"){let t=i.match("^[0-9]{1,4}-[0-9]{2}-[0-9]{2}[T ][0-9]{2}:[0-9]{2}");if(t!==null){let e=t[0];return[e,i.substring(e.length)]}}return undefined}function w(i,e){if(e.getAttribute("type")==="date"){let t=i.match("^[0-9]{1,4}-[0-9]{2}-[0-9]{2}");if(t!==null){let e=t[0];return[e,i.substring(e.length)]}}return undefined}function S(i,e){if(e.getAttribute("type")==="time"){let t=i.match("^[0-9]{2}:[0-9]{2}(:[0-9]{2})?");if(t!==null){let e=t[0];return[e,i.substring(e.length)]}}return undefined}function y(t,i){if(i.tagName==="SELECT"){let e=[...i.options].map(e=>e.value).filter(e=>e!=="").filter(e=>t.startsWith(e)).sort((e,t)=>t.length-e.length).find(e=>true);if(e){return[e,t.substring(e.length)]}}return undefined}function T(e,t){return[e,""]}function x(i,n){for(let t in C){let e=C[t](i,n);if(e!==undefined){return e}}return undefined}function N(i,n,r){if(n.length==0){return""}else if(n.length>1){return n[r]}else{let[e,t]=i.slice(0,r+1).reduce(([e,t],i)=>x(t,i),[undefined,n[0]]);return e}}function v(e){return e.getAttribute("name")||e.getAttribute("persist-fields-name")}function O(e,t,i){return e==="cookie"?t:e==="http"?i:i!==undefined?i:t}function I(n,r,l,s){let a=v(l);let o=O(r,a,s);let u=r==="local"||r==="session"||r==="http";let f=c(n,a,e);g(r,o,e=>{i(n,l,a,u?e[a]:e)});window.addEventListener("htmx:persistFieldsSave",e=>{if(e.detail.scope!==n){g(r,o,e=>{i(n,l,a,u?e[a]:e)})}});l.setAttribute("data-persist-fields-initialized",e(l).join(","));htmx.process(l);if(!l.hasAttribute("readonly")){q.getTriggerSpecs(l).forEach(e=>{let t=q.getInternalData(l);q.addTriggerHandler(l,e,t,(e,t)=>{if(htmx.closest(e,htmx.config.disableSelector)){return}let i=c(n,a,d);g(r,o,e=>{let t=u?p(a,e):undefined;if(JSON.stringify(i)!=JSON.stringify(f)||l.required){if(t&&!Array.isArray(t)){t[a]=i}else{t=i}}h(r,t,o,s);window.dispatchEvent(new CustomEvent("htmx:persistFieldsSave",{detail:{scope:n,storage:r}}))})})})}}let R=["session","local","query","fragment","cookie","http"];let _=R.filter(e=>t(e+"Storage"));let k=_.map(e=>"[persist-fields-"+e+"]").join(",");var q;var C;htmx.defineExtension("persist-fields",{_ext_persist_fields:true,init:function(e){q=e;C=[m,A,b,E,w,S,y,T]},onEvent:function(e,t){if(e==="htmx:persistFieldsClear"){let l=htmx.closest(t.detail.elt,k);if(l){let n=_.find(e=>l.hasAttribute("persist-fields-"+e));let r=l.getAttribute("persist-fields-"+n);u(l).forEach(e=>{let t=v(e);if(r==="indexed"){let e=u(l).map(v).filter(s);r=e.indexOf(t)}else if(r===""||n==="query"||n==="fragment"){r=undefined}let i=O(n,t,r);f(n,l,i)})}}else if(e==="htmx:afterProcessNode"){u(t.detail.elt).filter(e=>!e.hasAttribute("data-persist-fields-initialized")).forEach(i=>{let n=htmx.closest(i,k);if(n){let e=_.find(e=>n.hasAttribute("persist-fields-"+e));let t=n.getAttribute("persist-fields-"+e);if(t==="indexed"){let e=u(n).map(v).filter(s);t=e.indexOf(v(i))}else if(t===""||e==="query"||e==="fragment"){t=undefined}I(n,e,i,t)}})}}})})();